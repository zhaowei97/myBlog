## 1. 同源策略

### 1.1 什么是源

简单理解就是我们常规浏览器输入的url地址，比如说`https://www.baidu.com`。总共分为三部分组成：协议、域名、端口
| 名称 | 代表部分 |
| ---- | ---- |
| 协议 | http、https |
| 域名 | www.baidu.com |
| 端口号 | 80、443 | 

> 其中http协议默认是80，https默认是443

而所谓的同源就是协议、域名、端口号这三部分保持一致，只有双方处于同源条件下才能互相访问资源以及操作dom，反之则会收到对应安全策略的限制，这个策略就是同源策略。


### 1.2 同源策略的用途

* DOM层面：限制了不同源的JS脚本对当前DOM对象读和写的操作
* 数据层面：限制不同源站点读取当前站点的Cookie、IndenxDB、LocalStorage等
* 网络层面：限制了通过 XMLHttpRequest 等方式将站点的数据发送给不同源的站点

## 2. XSS
> XSS(Cross Site Script)跨站脚本攻击。指的是向客户端注入恶意脚本代码。

### 2.1 类型
* 存储型：将攻击存储在服务端，常见的是在评论区插入攻击脚本，然后存储到服务端，客户端其他能看到该评论的用户则都会受到对应的攻击。
* 反射型：常用的钓鱼链接，点击后触发恶意的URL请求，然后客户端解析请求返回的恶意代码并执行，从而达到攻击的目的。
* DOM型：将恶意脚本注入到用户的页面中。例如网络劫持---在页面传输过程中修改返回的HTML页面内容。

### 2.2 预防XSS
* 输入检查： 对输入内容中的script标签以及iframe标签进行转义。
* 设置httpOnly： 不允许通过js获取cookie, 只能够在http请求中使用。
* 开启CPS(内容安全策略)：开启白名单，阻止白名单外的资源加载及运行。

## 3. CSFR
> CSRF攻击（Cross-site request forgery）跨站请求伪造：利用用户的登录状态，并通过第三方的站点来做一些坏事。

### 3.1 CSRF类型
* 自动发起GET请求
`
<img src="https://xxxx/index.html?name=test&number=100">
`

将转账接口隐藏到img标签内，页面加载时就会去请求对用img资源，如果服务端没做判断啥的，就会默认发起转账。


* 自动发起POST请求
```
    <form id='hacker-form' action="https://xxxx" method=POST>
        <input type="hidden" name="name" value="test" />
        <input type="hidden" name="number" value="100" />
    </form>
```

`
document.getElementById('hacker-form').submit();
`

在页面中构建一个隐藏表单，然后在页面加载时候自动获取对应表单并触发提交操作。



* 链接点击
`
<a href="https://xxxx?user=test&number=100" taget="_blank">
    是兄弟就来砍我
  </a>
`

所谓陷阱广告一类

### CSRF防御
* 验证Referer： 浏览器除了会自动带上cookie还会带上Referer标识，验证是否为当前网站页面。不过请求头很容易伪造。
* 验证token：只有请求携带正确token以及cookie才会被认为合法（token为服务端返回）

## 4.SQL注入
> 范畴属于后端方面，不深究，只展示下案例

前端部分：
```
<form action="/login" method="POST">
  <p>Username: <input type="text" name="username" /></p>
  <p>Password: <input type="password" name="password" /></p>
  <p><input type="submit" value="登陆" /></p>
</form>
```
后端部分：
```
let querySQL = `
  SELECT *
  FROM user
  WHERE username='${username}'
  AND psw='${password}'
`;
```

前端输入
```
用户名：'test' OR 1=1 -- 
密码：123456
```

`--` 代表注释，也就是变成了SELECT * FROM user WHERE username='test' OR 1 = 1 --' AND psw='xxxx'。显然是恒成立的了。

## 5.流量劫持

### 5.1 DNS劫持
> 当用户通过某一个域名访问一个站点的时候，被篡改的 DNS 服务器返回的是一个恶意的钓鱼站点的 IP，用户就被劫持到了恶意钓鱼站点，然后继而会被钓鱼输入各种账号密码信息，泄漏隐私。

### 5.2 HTTP劫持
> 跟DNS劫持一个性质，都是不法运营商和黑产的勾当。通过篡改请求的返回内容实现页面劫持。可以换成HTTPS实现对应的防御。
